!function(){"use strict";function e(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function t(e,n){return t=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},t(e,n)}function n(e){return n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},n(e)}function r(e,t){if(t&&("object"===n(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}function a(e){return a=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},a(e)}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function u(e,t,n){return t&&i(e.prototype,t),n&&i(e,n),e}var c=function(){function e(){o(this,e)}return u(e,[{key:"get",value:function(e){var t={method:"GET",credentials:"include",url:e};return this.send(t)}},{key:"getPub",value:function(e){var t={method:"GET",url:e};return this.send(t)}},{key:"post",value:function(e){var t={url:e.url,method:"POST",data:e.data||{},credentials:e.credentials||null,mode:e.mode||null};return this.send(t)}},{key:"sendBeacon",value:function(e){var t=e.url,n=e.data;try{var r=JSON.stringify(n);return navigator.sendBeacon(t,r)}catch(e){console.error("Send beacon: ",e)}}},{key:"send",value:function(e){var t,n,r,a={},o=e.method;return e.data&&(a["Content-Type"]="text/plain",t=JSON.stringify(e.data)),e.mode&&(n=e.mode),e.credentials&&(r=e.credentials),fetch(e.url,{credentials:r,method:o,headers:a,mode:n,body:t})}}]),e}(),s=JSON.parse('{"pT":"https://matching.truffle.bid/sync/adv","ZX":"https://analytics.truffle.bid/a/event"}');new c;function l(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function d(e){return function(e){if(Array.isArray(e))return l(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||function(e,t){if(e){if("string"==typeof e)return l(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?l(e,t):void 0}}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}var f=function(e,t){var n;return function(){var r=arguments,a=this,o=function(){e.apply(a,r)};clearTimeout(n),n=setTimeout(o,t)}};function v(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"==typeof e)return g(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return g(e,t)}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,i=!0,u=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return i=e.done,e},e:function(e){u=!0,o=e},f:function(){try{i||null==n.return||n.return()}finally{if(u)throw o}}}}function g(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var h=new c,y=/[0-9]{18}/,p=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};o(this,e),this.params=t,this.siteParams=n,this.packageData=[],this.startSession=null,this.avgScrollSpeed={count:0,sumScrollSpeed:0,avgSpeed:0},this.countEvents={count:0,events:[]},this.bidId=null,this.scrollTicks=0,this.sumDelta=0}return u(e,[{key:"onHit",value:function(){var e=this.getMainEventData("hit");this.addToPackageData(e),this.send()}},{key:"onClick",value:function(){var e,t=this;document.addEventListener("click",(function(n){var r=n.target,a=t.getMainEventData("click");a.tag_name=r.tagName.toLowerCase(),t.onChange(r),clearTimeout(e),t.addToPackageData(a),e=setTimeout((function(){t.debounceSendData("send")}),200)}))}},{key:"onScroll",value:function(){var e,t,n,r=this;this.scrollTicks=0,this.sumDelta=0;var a=f((function(){var t=r.getMainEventData("scroll"),a=Math.round(r.sumDelta/r.scrollTicks);a=a>0?a:-a,t.avg_scroll_speed=a,t.scroll_ticks=r.scrollTicks,r.sumAvgScrollSpeed(a),e=n=r.sumDelta=r.scrollTicks=0,r.addToPackageData(t),r.debounceSendData("send")}),100);window.addEventListener("scroll",(function(){r.scrollTicks++,t=window.scrollY,e&&(n=t-e,r.sumDelta+=n),e=t,a()}))}},{key:"onChange",value:function(e){var t=this;if(-1!==["INPUT","TEXTAREA"].indexOf(e.tagName)){var n=function n(r){var a=t.getMainEventData("change");a.tag_name=e.tagName.toLowerCase(),t.addToPackageData(a),t.debounceSendData("send"),e.removeEventListener("change",n)};e.addEventListener("change",n),e.addEventListener("blur",(function t(r){e.removeEventListener("change",n),e.removeEventListener("blur",t)}))}}},{key:"onClose",value:function(){var e=this;window.addEventListener("visibilitychange",(function(){if("hidden"===document.visibilityState){var t=e.getMainEventData("close");t.session_time=e.getTimeSession(),t.event_count=e.countEvents.count,t.event_types=e.countEvents.events.join(","),t.avg_scroll_speed=e.avgScrollSpeed.avgSpeed,e.addToPackageData(t),e.debounceSendData("sendBeacon")}}))}},{key:"onRedirect",value:function(){var e=this,t=document.querySelectorAll("a");t.length&&t.forEach((function(t){t.addEventListener("click",(function(t){t.preventDefault();var n=t.currentTarget,r=e.getMainEventData("redirect"),a=n.href||"",o=n.getAttribute("target");r.redirect_url=a||"",e.addToPackageData(r),e.debounceSendData("send"),o&&"_blank"===o?window.open(a,"_blank"):window.location.href=a}))}))}},{key:"getMainEventData",value:function(e){var t={};return this.setCountEvents(e),this.bidId&&(t.bid_id=this.bidId),t.event_type=e,t.time=this.siteParams.getTimeUtc(),t.domain=this.siteParams.getDomain(),t.page=this.siteParams.getPage(),this.params.pixel_key&&(t.pixel_id=this.params.pixel_key),this.params.duid&&(t.duid=this.params.duid),t}},{key:"addToPackageData",value:function(e){this.packageData.push(e)}},{key:"sumAvgScrollSpeed",value:function(e){this.avgScrollSpeed.count++,this.avgScrollSpeed.sumScrollSpeed+=e,this.avgScrollSpeed.avgSpeed=Math.round(this.avgScrollSpeed.sumScrollSpeed/this.avgScrollSpeed.count)}},{key:"setCountEvents",value:function(e){this.countEvents.count+=1,this.countEvents.events.push(e)}},{key:"getTimeSession",value:function(){return Math.round((Date.now()-this.startSession)/1e3)}},{key:"getBidId",value:function(){var e,t=new URLSearchParams(this.siteParams.getLocationSearch()),n=v(t.keys());try{for(n.s();!(e=n.n()).done;){var r=e.value;if(r.includes("utm")){var a=t.get(r);y.test(a)&&(this.bidId=a)}}}catch(e){n.e(e)}finally{n.f()}}},{key:"controllerRequests",value:function(e){switch(e){case"send":this.send();break;case"sendBeacon":this.sendBeacon()}}},{key:"createRequestParams",value:function(){var e={url:s.ZX,data:d(this.packageData)};return this.packageData=[],e}},{key:"send",value:function(){h.post(this.createRequestParams())}},{key:"sendBeacon",value:function(){h.sendBeacon(this.createRequestParams())}},{key:"addEvents",value:function(){this.getBidId(),this.onHit(),this.onClick(),this.onScroll(),this.onClose()}},{key:"init",value:function(){this.debounceSendData=f(this.controllerRequests,1e3),this.startSession=Date.now(),this.addEvents()}}]),e}(),m=function(){function e(){o(this,e)}return u(e,[{key:"getDomain",value:function(){return document.location.host}},{key:"getPage",value:function(){return document.location.href}},{key:"getLocationSearch",value:function(){return document.location.search}},{key:"getRef",value:function(){return document.referrer}},{key:"getConnection",value:function(){var e=window.navigator.connection||window.navigator.mozConnection||window.navigator.webkitConnection;return e?{downlink:e.downlink,effectiveType:e.effectiveType,rtt:e.rtt,saveData:e.saveData}:null}},{key:"getCookieEnabled",value:function(){return this.getNavigatorData("cookieEnabled")}},{key:"getDeviceMemory",value:function(){return this.getNavigatorData("deviceMemory")}},{key:"getHardwareConcurrency",value:function(){return this.getNavigatorData("hardwareConcurrency")}},{key:"getLang",value:function(){return this.getNavigatorData("language")}},{key:"getLanguages",value:function(){return this.getNavigatorData("languages")}},{key:"getMaxTouchPoints",value:function(){return this.getNavigatorData("maxTouchPoints")}},{key:"getOs",value:function(){return this.getNavigatorData("platform")}},{key:"getUa",value:function(){return this.getNavigatorData("userAgent")}},{key:"getUaData",value:function(){if(!k())return null;var e=window.navigator.userAgentData;return e?{brands:e.brands,mobile:e.mobile,platform:e.platform}:null}},{key:"getVendor",value:function(){return this.getNavigatorData("vendor")}},{key:"getWebDriver",value:function(){return this.getNavigatorData("webdriver")}},{key:"getTimeUtc",value:function(){var e=new Date;return"".concat(b(e.getUTCHours()),":").concat(b(e.getMinutes()),":").concat(b(e.getSeconds()))}},{key:"getDateUtc",value:function(){var e=new Date,t={year:e.getFullYear(),month:e.getMonth(),day:e.getDate(),hours:e.getUTCHours(),minutes:e.getMinutes(),seconds:e.getSeconds()};return"".concat(t.year,"-").concat(b(t.month),"-").concat(b(t.day)," ").concat(b(t.hours),":").concat(b(t.minutes),":").concat(b(t.seconds))}},{key:"getNavigatorData",value:function(e){return function(e){return!k()||function(e){return void 0===window.navigator[e]}(e)||function(e){return""===window.navigator[e]}(e)||function(e){return"object"===n(window.navigator[e])&&0===Object.keys(window.navigator[e]).length}(e)}(e)?null:window.navigator[e]}}]),e}();function b(e){return e<10?"0".concat(e):e}function k(){return"navigator"in window}var w=new m;function S(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function D(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,o=a(e);if(t){var i=a(this).constructor;n=Reflect.construct(o,arguments,i)}else n=o.apply(this,arguments);return r(this,n)}}var T=new c,E=new m,P=function(){function e(){o(this,e)}return u(e,[{key:"sendGet",value:function(e){return T.get(e)}},{key:"sendPost",value:function(e){return T.post(e)}}]),e}(),O=function(n){!function(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(n&&n.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),n&&t(e,n)}(a,n);var r=D(a);function a(){return o(this,a),r.apply(this,arguments)}return u(a,[{key:"init",value:function(){if(void 0!==window.ttf.pixelId){var t=window.ttf.pixelId;if(t){var n=function(t){for(var n=1;n<arguments.length;n++){var r=null!=arguments[n]?arguments[n]:{};n%2?S(Object(r),!0).forEach((function(n){e(t,n,r[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):S(Object(r)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))}))}return t}({pixel_key:t},function(){var e={};return e.connection=w.getConnection(),e.cookie_enabled=w.getCookieEnabled(),e.device_memory=w.getDeviceMemory(),e.hardware_concurrency=w.getHardwareConcurrency(),e.language=w.getLang(),e.languages=w.getLanguages(),e.max_touch_points=w.getMaxTouchPoints(),e.user_agent=w.getUa(),e.user_agent_data=w.getUaData(),e.vendor=w.getVendor(),e.web_driver=w.getWebDriver(),e}()),r={url:s.pT,data:n},a={pixel_key:t};this.sendPost(r).then((function(e){return e.text()})).then((function(e){a.duid=e,new p(a,E).init()}))}}}}]),a}(P);(new O).init()}();